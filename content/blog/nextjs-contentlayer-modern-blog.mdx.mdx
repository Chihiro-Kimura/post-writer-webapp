---
title: 'Next.js + Contentlayerã§ãƒ–ãƒ­ã‚°æ©Ÿèƒ½ä»˜ãWebã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•'
date: '2024-03-19'
description: 'Next.js 14ã¨Contentlayerã‚’ä½¿ç”¨ã—ãŸãƒ–ãƒ­ã‚°æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™'
published: true
image: '/images/download.png'
---

# Next.js + Contentlayer ã§ãƒ–ãƒ­ã‚°æ©Ÿèƒ½ä»˜ã Web ã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•

## ğŸš€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

```bash:e7149296-3b9c-4e0a-be64-7fe9ffd7449b
npx create-next-app@latest post-writer-webapp --typescript --tailwind --app
```

### 2. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install contentlayer next-contentlayer date-fns
npm install @next-auth/prisma-adapter next-auth
npm install @prisma/client prisma
npm install shadcn-ui @radix-ui/react-alert-dialog @radix-ui/react-dropdown-menu
```

## ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. Prisma ã®åˆæœŸåŒ–

```bash
npx prisma init
```

### 2. ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©

```prisma
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]
  posts         Post[]
}

model Post {
  id        String   @id @default(cuid())
  title     String
  content   String?
  published Boolean  @default(false)
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

## ğŸ“ Contentlayer ã®è¨­å®š

### 1. contentlayer.config.ts ã®è¨­å®š

```typescript
import { defineDocumentType, makeSource } from 'contentlayer/source-files';

export const Post = defineDocumentType(() => ({
  name: 'Post',
  filePathPattern: `blog/**/*.{md,mdx}`,
  contentType: 'mdx',
  fields: {
    title: { type: 'string', required: true },
    date: { type: 'date', required: true },
    description: { type: 'string', required: false },
    published: { type: 'boolean', required: false, default: true },
  },
  computedFields: {
    slug: {
      type: 'string',
      resolve: (doc) => `/${doc._raw.flattenedPath}`,
    },
  },
}));

export default makeSource({
  contentDirPath: './content',
  documentTypes: [Post],
});
```

## ğŸ” èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£…

### 1. NextAuth.js ã®è¨­å®š

```typescript
// app/api/auth/[...nextauth]/route.ts
import NextAuth from 'next-auth';
import GithubProvider from 'next-auth/providers/github';
import GoogleProvider from 'next-auth/providers/google';
import { PrismaAdapter } from '@next-auth/prisma-adapter';
import prisma from '@/lib/prisma';

export const authOptions = {
  adapter: PrismaAdapter(prisma),
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET,
    }),
    GoogleProvider({
      clientId: process.env.GOOGLE_ID,
      clientSecret: process.env.GOOGLE_SECRET,
    }),
  ],
};

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };
```

## ğŸ“± UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…

### 1. ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸

```typescript
// app/blog/page.tsx
import { allPosts } from 'contentlayer/generated';
import { compareDesc } from 'date-fns';

export default function BlogPage() {
  const posts = allPosts.sort((a, b) =>
    compareDesc(new Date(a.date), new Date(b.date))
  );

  return (
    <div className="container mx-auto py-8">
      <h1 className="text-3xl font-bold mb-8">Blog Posts</h1>
      <div className="grid gap-4">
        {posts.map((post) => (
          <article key={post._id} className="p-4 border rounded">
            <h2 className="text-xl font-semibold">{post.title}</h2>
            <time className="text-gray-500">
              {new Date(post.date).toLocaleDateString()}
            </time>
            <p className="mt-2">{post.description}</p>
          </article>
        ))}
      </div>
    </div>
  );
}
```

### 2. è¨˜äº‹ç·¨é›†ãƒšãƒ¼ã‚¸

```typescript
// app/editor/[id]/page.tsx
import { Editor } from '@/components/Editor';
import { getPostById } from '@/lib/posts';

export default async function EditorPage({ params }) {
  const post = await getPostById(params.id);

  return (
    <div className="container mx-auto py-8">
      <Editor post={post} />
    </div>
  );
}
```

## ğŸ¨ ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®è¨­å®š

### 1. Tailwind CSS ã®è¨­å®š

```typescript
// tailwind.config.ts
import type { Config } from 'tailwindcss';

export default {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      typography: {
        DEFAULT: {
          css: {
            maxWidth: '65ch',
            color: 'inherit',
            a: {
              color: 'inherit',
              textDecoration: 'underline',
              fontWeight: '500',
            },
          },
        },
      },
    },
  },
  plugins: [require('@tailwindcss/typography')],
};
```

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. Vercel ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. GitHub ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ
2. Vercel ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
4. ãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Ÿè¡Œ

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```env
DATABASE_URL=your_database_url
GITHUB_ID=your_github_id
GITHUB_SECRET=your_github_secret
GOOGLE_ID=your_google_id
GOOGLE_SECRET=your_google_secret
NEXTAUTH_SECRET=your_nextauth_secret
NEXTAUTH_URL=your_nextauth_url
```

## ğŸ” ä¸»è¦ãªæ©Ÿèƒ½ã®å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ

1. **MDX ã®å‡¦ç†**

   - Contentlayer ã«ã‚ˆã‚‹å‹å®‰å…¨ãª MDX ã®å‡¦ç†
   - ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¿½åŠ 
   - ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã®æ´»ç”¨

2. **èªè¨¼ãƒ•ãƒ­ãƒ¼**

   - NextAuth.js ã«ã‚ˆã‚‹ OAuth èªè¨¼
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
   - ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã®å®Ÿè£…

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ**
   - Prisma ã‚’ä½¿ç”¨ã—ãŸ CRUD æ“ä½œ
   - ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š
   - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

## ğŸ“Œ æ³¨æ„ç‚¹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**

   - ç”»åƒã®æœ€é©åŒ–
   - ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é©åˆ‡ãªä½¿ç”¨
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¤œè¨

2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**

   - ç’°å¢ƒå¤‰æ•°ã®é©åˆ‡ãªç®¡ç†
   - CSRF ãƒˆãƒ¼ã‚¯ãƒ³ã®å®Ÿè£…
   - å…¥åŠ›å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

3. **ä¿å®ˆæ€§**
   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é©åˆ‡ãªåˆ†å‰²
   - å‹ã®æ´»ç”¨
   - ãƒ†ã‚¹ãƒˆã®å®Ÿè£…

## ğŸ‰ ã¾ã¨ã‚

Next.js 14 ã¨ Contentlayer ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€å‹å®‰å…¨ã§ä¿å®ˆæ€§ã®é«˜ã„ãƒ–ãƒ­ã‚°æ©Ÿèƒ½ä»˜ã Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€é–‹ç™ºè€…ä½“é¨“ã¨å®Ÿè¡Œæ™‚ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ä¸¡æ–¹ã‚’æœ€é©åŒ–ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
